{% assign base_url = canonical_url | split:'?' | first %}

{%- assign locale_part = base_url | split: '/' | slice: 3, 1 | first -%}

{%- assign short_locale = locale_part | split:'-' | first -%}

{%- comment -%}
Replace locale in URL IF it exists in the path
Examples:
 /de-fr/... → /de/...
 /en-be/... → /en/...
 /fr-ch/... → /fr/...
Also supports simple locales: /de/, /fr/, /en/
{%- endcomment -%}

{%- if locale_part contains '-' %}
    {%- assign old = '/' | append: locale_part | append: '/' -%}
    {%- assign new = '/' | append: short_locale | append: '/' -%}
    {%- assign base_url = base_url | replace: old, new -%}
{%- elsif locale_part == 'de'
or locale_part == 'en'
or locale_part == 'fr'
or locale_part == 'nl'
or locale_part == 'it'
or locale_part == 'es'
or locale_part == 'pt'
or locale_part == 'pl'
or locale_part == 'sv'
or locale_part == 'da'
or locale_part == 'fi'
or locale_part == 'cs'
or locale_part == 'sk'
or locale_part == 'no'
or locale_part == 'hu'
or locale_part == 'ro'
or locale_part == 'bg'
or locale_part == 'el'
%}
    {%- comment -%} Already short locale, do nothing {%- endcomment -%}
{% endif %}

<link rel="canonical" href="{{ base_url }}">
